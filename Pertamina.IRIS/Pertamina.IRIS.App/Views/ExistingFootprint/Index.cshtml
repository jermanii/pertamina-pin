@using Pertamina.IRIS.Models.Base
@inject GlobalVariableBaseModel globalParam
@using Microsoft.AspNetCore.Http
@model Pertamina.IRIS.Models.ViewModels.ExistingFootprintViewModel
@inject IHttpContextAccessor HttpContextAccessor

@{
    ViewData["Title"] = "Existing Footprints";
    Layout = "~/Views/Shared/_Layout.cshtml";
    var controllerName = this.ViewContext.RouteData.Values["controller"].ToString();
    string IsAdd = Pertamina.IRIS.App.Helpers.HtmlHelper.IsAdd(HttpContextAccessor.HttpContext.Session);
}

<div class="app-main flex-column flex-row-fluid">
    <div class="d-flex flex-column flex-column-fluid">
        <div class="app-toolbar py-3 py-lg-6">
            <div class="app-container container-xxl d-flex flex-stack">
                <div class="page-title d-flex flex-column justify-content-center flex-wrap me-3">
                    <h1 class="page-heading d-flex text-dark fw-bold fs-3 flex-column justify-content-center my-0">Existing Footprints</h1>
                </div>
            </div>
        </div>
        <div class="app-content flex-column-fluid">
            <div class="app-container container-xxl">
                <div class="card card-flush">
                    <div class="card-body fs-6 py-10 px-10 py-lg-10 px-lg-10 text-gray-700">
                        <div class="row py-2">
                            <span>
                                Filter By :
                                <a class="btn btn-icon-danger btn-text-danger" onclick="resetAllFilter()">
                                    <i class="fa-regular fa-rectangle-xmark"></i>Reset All Filter
                                </a>
                            </span>
                        </div>
                        <div class="row py-2">
                            <div class="col-3">
                                @Html.DropDownListFor(x => x.EntitasPertaminaId,
                                         new MultiSelectList(Enumerable.Empty<SelectListItem>()),
                                         new
                                         {
                                             @id = "ddlEntitasPertamina",
                                             @class = "form-select form-select-solid form-select-lg fw-semibold",
                                             aria_label = "Name",
                                             multiple = "multiple",
                                             data_control = "select2",
                                             data_placeholder = "Name",
                                             data_allow_clear = "true"
                                         })
                            </div>
                            <div class="col-3">
                                @Html.DropDownListFor(x => x.StreamBusinessId,
                                         new MultiSelectList(Enumerable.Empty<SelectListItem>()),
                                         new
                                         {
                                             @id = "ddlStreamBusiness",
                                             @class = "form-select form-select-solid form-select-lg fw-semibold",
                                             aria_label = "Project Type",
                                             multiple = "multiple",
                                             data_control = "select2",
                                             data_placeholder = "Project Type",
                                             data_allow_clear = "true"
                                         })
                            </div>
                            

                            <div class="col-3">
                                @Html.DropDownListFor(x => x.GridYear,
                                         new MultiSelectList(Enumerable.Empty<SelectListItem>()),
                                         new
                                         {
                                             @id = "ddlYear",
                                             @class = "form-select form-select-solid form-select-lg fw-semibold",
                                             aria_label = "Year",
                                             multiple = "multiple",
                                             data_control = "select2",
                                             data_placeholder = "Year",
                                             data_type = "number",
                                             data_allow_clear = "true"
                                         })
                            </div>
                            <div class="col-3">
                                @Html.DropDownListFor(x => x.NegaraMitraId,
                                         new MultiSelectList(Enumerable.Empty<SelectListItem>()),
                                         new
                                         {
                                             @id = "ddlNegaraMitra",
                                             @class = "form-select form-select-solid form-select-lg fw-semibold",
                                             aria_label = "Partner Country",
                                             multiple = "multiple",
                                             data_control = "select2",
                                             data_placeholder = "Partner Country",
                                             data_allow_clear = "true"
                                         })
                            </div>
                            
                        </div>
                        <div class="row py-2">
                            
                            <div class="col-3">
                                <div class="row">
                                    <div class="col">
                                        <div class="input-group" >
                                            @Html.TextBoxFor(x => x.TotalAsset,
                                                     new
                                                     {
                                                         @id = "ddlMinTotalAssets",
                                                         @class = "form-control form-control-solid",
                                                         maxlength = 100,
                                                         aria_label = "Minimum Total Assets",
                                                         placeholder = "Minimum Total Assets",
                                                         @type = "number",
                                                         data_allow_clear = "true"
                                                     })

                                        </div>
                                    </div>
                                    <div class="col">
                                        <div class="input-group">
                                            @Html.TextBoxFor(x => x.TotalAsset,
                                                     new
                                                     {
                                                         @id = "ddlMaxTotalAssets",
                                                         @class = "form-control form-control-solid",
                                                         maxlength = 100,
                                                         aria_label = "Maximum Total Assets",
                                                         placeholder = "Maximum Total Assets",
                                                         @type = "number",
                                                         data_allow_clear = "true"
                                                     })
                                        </div>
                                    </div>
                                </div>
                               
                            </div>
                            <div class="col-3">
                                <div class="row">
                                    <div class="col">
                                        <div class="input-group">
                                            @Html.TextBoxFor(x => x.Revenue,
                                                     new
                                                     {
                                                         @id = "ddlMinRevenue",
                                                         @class = "form-control form-control-solid",
                                                         aria_label = "Minimum Revenue",
                                                         placeholder = "Minimum Revenue",
                                                         @type = "number",
                                                         data_allow_clear = "true"
                                                     })

                                        </div>
                                    </div>
                                    <div class="col">
                                        <div class="input-group">
                                            @Html.TextBoxFor(x => x.Revenue,
                                                     new
                                                     {
                                                         @id = "ddlMaxRevenue",
                                                         @class = "form-control form-control-solid",
                                                         aria_label = "Maximum Revenue",
                                                         placeholder = "Maximum Revenue",
                                                         @type = "number",
                                                         data_allow_clear = "true"
                                                     })
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-3">
                                <div class="row">
                                    <div class="col">
                                        <div class="input-group">
                                            @Html.TextBoxFor(x => x.Ebitda,
                                                     new
                                                     {
                                                         @id = "ddlMinEbitda",
                                                         @class = "form-control form-control-solid",
                                                         aria_label = "Minimum EBITDA",
                                                         placeholder = "Minimum EBITDA",
                                                         @type = "number",
                                                         data_allow_clear = "true"
                                                     })

                                        </div>
                                    </div>
                                    <div class="col">
                                        <div class="input-group">
                                            @Html.TextBoxFor(x => x.Ebitda,
                                                     new
                                                     {
                                                         @id = "ddlMaxEbitda",
                                                         @class = "form-control form-control-solid",
                                                         aria_label = "Maximum EBITDA",
                                                         placeholder = "Maximum EBITDA",
                                                         @type = "number",
                                                         data_allow_clear = "true"
                                                     })
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div> 
                    </div>
                </div>
            </div>
        </div>
        <div class="app-content flex-column-fluid">
            <div class="app-container container-xxl">
                <div class="card card-flush">
                    <div class="card-body fs-6 py-15 px-10 py-lg-15 px-lg-15 text-gray-700">
                        <div class="p-0">
                            <div class="d-flex flex-stack mb-5">
                                <div class="d-flex align-items-center position-relative my-1">
                                    <i class="ki-duotone ki-magnifier fs-1 position-absolute ms-6"><span class="path1"></span><span class="path2"></span></i>
                                    <input id="searchInput" type="text" data-kt-docs-table-filter="search" class="form-control form-control-solid w-250px ps-15" placeholder="Search" />
                                    <span class="ms-1" data-bs-toggle="tooltip" title="Search is applied to Name, PIC, Hub Lead, Project Type, Year, Negara Mitra">
                                        <i class="ki-duotone ki-information-5 text-gray-500 fs-1">
                                            <span class="path1"></span>
                                            <span class="path2"></span>
                                            <span class="path3"></span>
                                        </i>
                                    </span>
                                </div>
                                <div class="d-flex justify-content-end" data-kt-docs-table-toolbar="base">
                                    <div style="padding-right:10px;">
                                        <button id="exportExcel" type="button" class="btn btn-primary rotate" data-kt-menu-trigger="click" data-kt-menu-placement="bottom-start">
                                            <i class="ki-duotone ki-exit-up fs-2">
                                                <span class="path1"></span>
                                                <span class="path2"></span>
                                            </i>Export
                                        </button>
                                    </div>
                                    <button id="btnCreate"
                                            type="submit"
                                            class="btn btn-primary"
                                            onclick="location.href='@Url.Action("Create", "ExistingFootprint")'"
                                    @IsAdd>
                                        <i class="ki-duotone ki-plus fs-2"></i>
                                        Add Existing Footprints
                                    </button>
                                </div>
                            </div>
                            <table id="dataTable" class="table align-middle table-row-dashed fs-6 gy-5">
                                <thead>
                                    <tr class="text-start text-gray-400 fw-bold fs-7 text-uppercase gs-0">
                                        <th>Name</th>
                                        <th>PIC</th>
                                        <th>Hub Lead</th>
                                        <th>Project Type</th>
                                        <th>Total Assets</th>
                                        <th>Total Revenue</th>
                                        <th>EBITDA</th>
                                        <th>Year</th>
                                        <th>Partner Country</th>
                                        <th class="text-end min-w-125px">Actions</th>
                                    </tr>
                                </thead>
                                <tbody class="text-gray-600 fw-semibold">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
@section Scripts {
    <script>
        var param = (function (param) {
            param.prefix = '@globalParam.PrefixApiUrl';
            param.urlAction = '@globalParam.PrefixRootName' + '@controllerName/';
            param.dataGrid = '@globalParam.PrefixApiUrl' + 'ApiExistingFootprints/List';
            param.dataGridEvent = '@globalParam.PrefixApiUrl' + 'ApiExistingFootprints/ListEvent';
            param.dataCountSearchGrid = '@globalParam.PrefixApiUrl' + 'ApiExistingFootprints/GetCountSearch';
            param.updateGrid = '@Url.Action("Update", "ExistingFootprint")';
            param.deleteGrid = '@Url.Action("Delete", "ExistingFootprint")';
            return param;
        })(param || {});
        $('#exportExcel').click(function(){
            var entitasPertaminaId = $('#ddlEntitasPertamina').val();
            var picFungsiId = $('#ddlPicFungsi').val();
            var hubHeadId = $('#ddlHubLead').val();
            var projectTypeId = $('#ddlStreamBusiness').val();
            var totalAssetsMinOp = $('#ddlMinTotalAssets').val();
            var totalAssetsMaxOp = $('#ddlMaxTotalAssets').val();
            var revenueMinOp = $('#ddlMinRevenue').val();
            var revenueMaxOp = $('#ddlMaxRevenue').val();
            var ebitdaMinOp = $('#ddlMinEbitda').val();
            var ebitdaMaxOp = $('#ddlMaxEbitda').val();
            var yearOp = $('#ddlYear').val();
            var partnerCountryId = $('#ddlNegaraMitra').val();
            var searchGrid = $('#searchInput').val();

            var url = '@Url.Action("DownloadData", "ExistingFootprint")';
            window.location.href = url + '?searchGrid=' + searchGrid + '&entitasPertaminaId=' + entitasPertaminaId + '&projectTypeId=' + projectTypeId + '&totalAssetsMinOp=' + totalAssetsMinOp + '&totalAssetsMaxOp=' + totalAssetsMaxOp + '&revenueMinOp=' + revenueMinOp + '&revenueMaxOp=' + revenueMaxOp  + '&ebitdaMinOp=' + ebitdaMinOp + '&ebitdaMaxOp=' + ebitdaMaxOp + '&yearOp=' + yearOp + '&partnerCountryId=' + partnerCountryId ;;
        })
        console.log(param);

        function resetAllFilter() {
            location.reload();
        }
    </script>
    <script src="~/js/form/base-url-api.js"></script>
    <script src="~/js/form/existingFootprints.js"></script>
     
}
